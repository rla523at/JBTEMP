# DirectX Graphics Infrastructure
`DirectX Graphics Infrastructure (DXGI)`는 DirectX API의 일부로, 그래픽 어댑터와 디스플레이를 관리하고 조작하는 데 필요한 기능을 제공하는 라이브러리다. DXGI는 Direct3D와 같은 그래픽 API와 함께 사용되어 그래픽 리소스, 디스플레이 모드, 스왑 체인 등의 관리를 단순화하는 역할을 한다.

## DXGI 역할
DXGI의 역할을 조금더 자세하게 살펴보자.

### 하드웨어 추상화
그래픽 어댑터와 디스플레이 장치 간의 추상화 계층을 제공하여 개발자가 하드웨어 세부 사항에 신경 쓰지 않고도 작업을 수행할 수 있게 한다. 이를 통해 다양한 하드웨어 환경에서 일관된 성능과 기능을 제공할 수 있다.

### 스왑체인 관리
프레임 버퍼를 관리하여 더블 버퍼링, 트리플 버퍼링 등의 기술을 지원하고, 스크린 티어링을 방지하는 데 도움을 준다. 스왑 체인은 두 개 이상의 프레임 버퍼를 사용하여 새로운 프레임을 준비하는 동안 기존 프레임을 디스플레이에 표시할 수 있게 한다.

### 디스플레이 모드 관리
디스플레이 해상도, 리프레시율 등의 설정을 관리하고 변경할 수 있게 한다. 이를 통해 다양한 디스플레이 환경에 맞게 동적으로 화면 설정을 조정할 수 있다

### 멀티 어댑터 지원
여러 개의 그래픽 어댑터를 지원하여, 다중 디스플레이 환경이나 고성능 컴퓨팅 환경에서 효율적인 자원 관리를 가능하게 한다. 이를 통해 복잡한 렌더링 작업을 여러 어댑터에 분산시켜 성능을 향상시킬 수 있다.

## DXGI 객체와 인터페이스
DXGI는 COM(Component Object Model) 기반의 객체인 인터페이스를 통해 다양한 기능을 제공한다. 주요 인터페이스는 다음과 같다:

### IDXGIDevice
Direct3D 디바이스와 DXGI 간의 상호작용을 관리하는 중요한 역할을 한다. 이 인터페이스는 Direct3D 디바이스가 DXGI 팩토리 및 어댑터와 통신할 수 있도록 하며, 이를 통해 디스플레이 설정 및 리소스 관리를 효율적으로 처리할 수 있다.

주요 역할 및 기능은 다음과 같다.

####  DXGI 어댑터와의 상호작용
IDXGIDevice는 Direct3D 디바이스와 DXGI 어댑터 간의 통신을 관리하는 역할을 한다. 

`GetAdapter` 메서드를 사용하여 IDXGIAdapter 인터페이스를 얻어 어댑터의 속성이나 모드를 쿼리하고 설정할 수 있게 한다. 이를 통해 디스플레이 설정을 조정하거나 성능을 최적화한다.

#### 디스플레이와의 통합
Direct3D 디바이스가 디스플레이 장치와 통합될 수 있도록 돕는다. 이를 통해 다양한 디스플레이 출력 설정을 관리하고 변경할 수 있다. 디스플레이 출력은 모니터, 프로젝터, TV 등 다양한 장치를 포함한다.

해상도, 리프레시율 등의 디스플레이 설정을 변경할 수 있다. 이를 통해 다양한 디스플레이 환경에 맞게 설정을 동적으로 조정할 수 있다.

창 모드와 전체 화면 모드 간의 전환을 지원한다. 이를 통해 게임이나 멀티미디어 애플리케이션에서 유연한 디스플레이 모드 전환을 구현할 수 있다.

#### 리소스 공유
여러 디바이스 간의 리소스 공유를 가능하게 한다. 이는 복잡한 그래픽 애플리케이션에서 리소스를 효율적으로 관리할 수 있도록 돕는다. 리소스 공유는 멀티 GPU 설정이나 클러스터 컴퓨팅 환경에서 특히 중요하다.

IDXGIDevice를 사용하여 Direct3D 디바이스 간에 텍스처, 버퍼 등의 그래픽 리소스를 공유할 수 있다. 이를 통해 여러 디바이스가 동일한 리소스를 사용할 수 있게 되어 성능과 효율성을 높일 수 있다.

`QueryResourceResidency` 매서드를 사용하여 지정된 리소스가 로컬 비디오 메모리에 있는지, 공유 메모리에 있는지, 시스템 메모리에 있는지를 쿼리할 수 있다. 이를 통해 리소스의 위치와 접근 가능성을 확인할 수 있다.

#### GPU 스레드 우선 순위 관리
GPU 스레드의 우선 순위를 설정하고 쿼리할 수 있다. 이를 통해 GPU 작업의 우선 순위를 조정하여 특정 작업의 성능을 최적화할 수 있다.

`SetGPUThreadPriority` 매서드를 사용하여 GPU 스레드의 우선 순위를 설정할 수 있다. 이를 통해 중요한 작업의 우선 순위를 높이거나, 백그라운드 작업의 우선 순위를 낮출 수 있다.

`GetGPUThreadPriority` 매서드를 사용하여 현재 설정된 GPU 스레드의 우선 순위를 쿼리할 수 있다. 이를 통해 현재 시스템의 스레드 우선 순위 설정을 확인하고, 필요에 따라 조정할 수 있다.

### IDXGIFactory
DXGI 객체와 리소스를 생성하는 팩토리 인터페이스다. 스왑 체인, 어댑터, 디바이스 등을 생성할 수 있다. 이를 통해 그래픽 어댑터와 출력 장치를 관리하고, 스왑 체인을 생성할 수 있다.


#### 생성
CreateDXGIFactory 함수를 이용하여 생성할 수 있다.

```cpp
ComPtr<IDXGIFactory> dxgiFactory;
HRESULT hr = CreateDXGIFactory(__uuidof(IDXGIFactory), &dxgiFactory);
```


### IDXGIAdapter
그래픽 어댑터를 나타내는 인터페이스로, 어댑터의 속성이나 모드를 쿼리하고 설정할 수 있다. 이를 통해 애플리케이션은 그래픽 카드의 메모리, 성능, 지원하는 디스플레이 모드 등의 정보를 얻을 수 있다.

주요 역할은 다음과 같다.

#### 그래픽 어댑터 정보 제공
IDXGIAdapter는 시스템에 설치된 그래픽 어댑터의 정보를 제공한다. 이를 통해 애플리케이션은 사용 가능한 그래픽 하드웨어의 성능과 특성을 파악할 수 있다.

`GetDesc` 메서드를 이용하여 어댑터에 관한 정보를 담은 DXGI_ADAPTER_DESC 구조체를 얻을 수 있다.
```cpp
HRESULT GetDesc(DXGI_ADAPTER_DESC *pDesc);
```

DXGI_ADAPTER_DESC 구조체는 다음과 같이 정의되어 있다.
```cpp
typedef struct DXGI_ADAPTER_DESC {
    WCHAR Description[128];
    UINT VendorId;
    UINT DeviceId;
    UINT SubSysId;
    UINT Revision;
    SIZE_T DedicatedVideoMemory;
    SIZE_T DedicatedSystemMemory;
    SIZE_T SharedSystemMemory;
    LUID AdapterLuid;
} DXGI_ADAPTER_DESC;
```

각각의 멤버 변수는 다음과 같은 의미를 갖는다.

* Description
  * 어댑터의 이름을 나타낸다.
* VendorId
  * 벤더 ID를 나타낸다.
* DeviceId
  * 디바이스 ID를 나타낸다.
* SubSysId
  * 서브 시스템 ID를 나타낸다.
* Revision
  * 리비전 번호를 나타낸다.
* DedicatedVideoMemory
  * 전용 비디오 메모리 크기를 나타낸다.
* DedicatedSystemMemory
  * 전용 시스템 메모리 크기를 나타낸다.
* SharedSystemMemory
  * 공유 시스템 메모리 크기를 나타낸다.
* AdapterLuid
  * 어댑터의 로컬 고유 식별자(LUID)를 나타낸다.

#### 출력 관리
어댑터에 연결된 디스플레이 출력 장치(모니터 등)에 대한 정보를 제공하고, 이를 관리할 수 있다.

`EnumOutputs` 메서드를 이용하여 어댑터에 연결된 출력 장치를 나열하고 이를 통해 여러 출력 장치(모니터 등)를 관리할 수 있다.

```cpp
HRESULT EnumOutputs(UINT Output, IDXGIOutput **ppOutput);
```


### IDXGISwapChain
IDXGISwapChain는 프레임 버퍼를 관리하고 렌더링된 이미지를 화면에 표시하는 역할을 한다. IDXGISwapChain는 Direct3D 디바이스와 함께 사용되며, 주로 게임이나 그래픽 애플리케이션에서 화면에 그래픽을 출력하기 위해 사용된다.

이런 스왑 체인은 하나 이상의 백 버퍼와 하나의 프론트 버퍼로 구성된다. 프론트 버퍼는 현재 화면에 표시되는 버퍼이고, 백 버퍼는 다음 프레임을 렌더링할 버퍼다. 렌더링이 완료되면 백 버퍼와 프론트 버퍼를 교환(swap)하여 화면에 새로운 프레임을 표시한다.

이 때, 하나의 프론트 버퍼와 하나의 백 버퍼를 사용하여 렌더링이 완료되면 두 버퍼를 교환하는 방식을 더블 버퍼링이라고 한다.
그리고 프론트 버퍼와 두 개의 백 버퍼를 사용하여 더 부드러운 애니메이션과 입력 지연을 줄이는 방식을 트리플 버퍼링이라고 한다.

### IDXGIOutput
디스플레이 출력을 나타내는 인터페이스로, 모니터와 같은 출력 장치에 대한 정보와 제어를 제공한다. 연결된 모니터의 해상도, 리프레시율 등의 정보를 얻고 설정할 수 있다.


## DXGI 객체 계층 구조
DXGI는 그래픽 어댑터, 출력 장치, 스왑 체인 등의 관리와 상호작용을 위한 다양한 인터페이스를 제공하며, 이들 인터페이스는 계층 구조를 형성한다.

IDXGIFactory의 자식 객체는 IDXGIAdapter와 IDXGISwapChain이며, IDXGIAdapter의 자식 객체는 IDXGIOutput이다.

이를 그림으로 나타내면 다음과 같다.

```
IDXGIFactory
|-- IDXGIAdapter
|   |-- IDXGIOutput
|
|-- IDXGISwapChain
```
