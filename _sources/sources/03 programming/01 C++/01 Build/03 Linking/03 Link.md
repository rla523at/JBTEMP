# Link
위 단계에서 아무런 문제가 없었더라면 이제 비로소 진짜 링킹을 수행할 수 있다. 링킹이란, 각각의 TU들에서 생성된 목적 코드들을 한데 모아서 하나의 실행 파일을 만들어내는 작업이다. 물론 단순히 목적 코드들을 이어 붙이는 작업만 하는 것은 아니다.

링킹 과정이 끝나기 전 까지 변수들과 함수, 그리고 데이터들의 위치를 확정시킬 수 없다. 따라서 TU들이 생성한 목적 코드들에게는 각각의 심볼들의 저장 방식과 링크 방식에 따라서 여기 여기에 배치했으면 좋겠다라는 희망 사항이 작성되어 있다.

예를 들어서 아래의 코드를 보자.

```
static int a = 3;
int b = 3;
static const int c = 3;
static int d;

int func() {}
static int func2() {}
```

이 코드에 정의된 심볼들의 희망 위치들은 아래와 같이 나타난다.

```
$ nm test.o
0000000000000004 D b
0000000000000000 T _Z4funcv
0000000000000000 d _ZL1a
0000000000000000 r _ZL1c
0000000000000000 b _ZL1d
000000000000000b t _ZL5func2v
```

nm 프로그램은 심볼들의 이름들 왼쪽에 어떠한 방식으로 링크시에 심볼을 배치할지에 대한 정보를 보여준다.

대문자 알파벳의 경우 해당 심볼은 외부 링크 방식으로 선언된 심볼이란 의미이다. 즉 해당 심볼은 다른 TU에서 접근할 수 있는 심볼이다. 반면에 소문자 알파벳의 경우 해당 심볼은 내부 링크 방식으로 선언된 심볼이란 의미이다. 따라서 해당 심볼은 이 TU 안에서만 접근이 가능하다.

위 대문자로 된 심볼들을 보면 b, func 을 볼 수 있는데 모두 외부 링크 방식임을 알 수 있다. 반면에 나머지 a, c, d, func2는 모두 static 이므로 내부 링크 방식이다.

그 다음에 알파벳 자체는 어떤 방식으로 해당 심볼들을 배치할 지 알려준다. [nm의 man 페이지](https://linux.die.net/man/1/nm)에서 전체 알파벳들에 대한 설명을 볼 수 있으며 그 중 일부는 다음과 같다.

-   B, b : 초기화 되지 않은 데이터 섹션 (BSS 섹션)
-   D, d : 초기화 된 데이터 섹션
-   T, t : 텍스트 (코드) 섹션
-   R, r : 읽기 전용 (read only) 섹션

맨 앞에 오는 정수값은 섹션의 시작으로부터 해당 심볼이 어디에 위치해 있는지 알려준다. 예를 들어서 func함수의 경우 텍스트 섹션 시작 부분에 있다는 의미 이고 (오프셋이 0 이니까), func2 의 경우 b 만큼 떨어진 부분에 위치해있다는 의미다.

실제로 objdump 로 코드를 살펴보면

```
objdump -S s.o 

s.o:     file format elf64-x86-64


Disassembly of section .text:

0000000000000000 <_Z4funcv>:
   0:    f3 0f 1e fa              endbr64 
   4:    55                       push   %rbp
   5:    48 89 e5                 mov    %rsp,%rbp
   8:    90                       nop
   9:    5d                       pop    %rbp
   a:    c3                       retq   

000000000000000b <_ZL5func2v>:
   b:    f3 0f 1e fa              endbr64 
   f:    55                       push   %rbp
  10:    48 89 e5                 mov    %rsp,%rbp
  13:    90                       nop
  14:    5d                       pop    %rbp
  15:    c3                       retq   
```

정확히 0xb 부분에 func2 가 자리하고 있음을 알 수 있습니다. 여기서 0x는 뒤에 오는 숫자가 16진수임을 말한다.